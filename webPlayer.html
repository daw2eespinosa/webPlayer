<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
</head>
<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css"/>
<link type="text/css" rel="stylesheet" href="css/main.css"/>

<script >
    /**
     * 1. Set default params for all the elements:
     *  - progress = 0
     *  - progressBar = 0
     *  - currentTime = 0
     *  - volume = 0.50
     *  - muted = false
     */
    var currentPosition;
    function webPlayer(){
        var video = getVideo();
        var volume = getVolume();
        var webPlayer = getWebPlayer();
        setButtons(video);
        setDefaultOptions();

        volume.addEventListener("mousedown", function(event){setVolume(event);}, true);
        volume.addEventListener("mouseup", function (event) {setVolume(event);}, true);
        video.addEventListener("play", function(){setCurrentPosition(video)}, true);
        video.addEventListener("playing", function(){whilePlaying(video)}, true);
        video.addEventListener("ended", function(){toEnd(video)}, false);
//        webPlayer.addEventListener("mousemove", function(){toggleMenu()}, true);

    }

    function setCurrentPosition(video) {
        var progressBar = getProgressBar();
        var progress = getProgress();
        var step = getStep(video);
        configProgressBar(step);
        currentPosition = setInterval(function () {
//            console.log(video.currentTime)
            progressBar.value = video.currentTime;
            progress.value = video.currentTime;
            getTimer().innerHTML = progressBar.value;
        }, step);
    }

    function configProgressBar(step) {
        var progressBar = getProgressBar();
        var progress = getProgress();
        var video = getVideo();
//        progressBar.position = 0;

        try {
            console.log(video);
            console.log(video.duration);
            progress.max = video.duration;
            progressBar.max = video.duration;

        }
        catch (e){console.log(e);}
//        progress.value = 0;
        progressBar.step = step;
        progress.step = step;

        progressBar.addEventListener("mousedown", function(){getPositionUnderCursor();});
        progressBar.addEventListener("mouseup", function(){movePosition()});

//        progressBar.addEventListener("mousedown", function(event){changePosition(event);});
//        progressBar.addEventListener("mouseup", function (event){changePosition(event);});
    }
    function getPositionUnderCursor(){
        var video = getVideo();
        var progressBar = getProgressBar();
        toPause(video);
        currentPosition = setInterval(function(){
            getTimer().innerHTML = progressBar.value;
            video.currentTime = progressBar.value;
        }, 250);
    }
    function movePosition(){
        var progressBar = getProgressBar();
        var position = progressBar.value;
        var video = getVideo();
        resetCurrentPosition();
        video.currentTime = position;
        toPlay(video);

    }
/*    function changePosition(event){
        var video = getVideo();
        var progressBar = getProgressBar();
        var change;
        var a = function(){
            video.currentTime = progressBar.value;
            clearInterval(parseInt(progressBar.getAttribute("data-interval")))}
            video.play();
        var b = function(){
            video.pause();
            clearInterval(progressBar.getAttribute("data-interval"));
            change = setInterval(function(){video.currentTime = progressBar.value;}, 250);
            progressBar.setAttribute("data-interval", change);
            console.log(change);
        }
        switch (event.type){
            case "mousedown" : b(); break;
            case "mouseup" : a(); break;
            default : console.log("If you are reading this, I am so bad writting code: changePosition");
        }
    }

    function setCurrent(video) {
        var progressBar = getProgressBar();
        var progress = getProgress();
        var step = getStep(video);
        configProgressBar(step);
        var change;
        change = setInterval(function () {
//            console.log(video.currentTime)
            progressBar.value = video.currentTime;
            progress.value = video.currentTime;
            getTimer().innerHTML = progressBar.value;
        }, step);
        progressBar.setAttribute("data-interval", change);
    }*/

    function setVolume(event){
        var video = getVideo();
        var volumeLevel;
        var volume = getVolume();
        switch (event.type){
            case "mousedown" : volumeLevel = setInterval(function(){video.volume = volume.value; console.log(video.volume); volume.setAttribute("data-interval", volumeLevel)},250); break;
            case "mouseup" : clearInterval(parseInt(volume.getAttribute("data-interval"))); break;
            default : console.log("If you are reading this, I am so bad writting code: setVolume");
        }
    }
    function getTimer(){
        return document.getElementById("actualPosition");
    }
    function getStep(video){
        return video.duration / (video.duration * 1000);
    }
    function toPlay(video){
        video.play();
//        console.log("inicio")
    }
    function toMute(video){
        video.muted = !video.muted;
    }
    function toPause(video){
        video.pause();
        resetCurrentPosition();
    }
    function toStop(video){
        video.pause();
        toEnd(video);
    }
    function resetCurrentPosition() {
        clearInterval(currentPosition);
    }
    function toEnd(video){
        resetCurrentPosition();
//        console.log(currentPosition);
        video.currentTime = 0;
//        console.log(currentPosition);
    }
    function whilePlaying(video){
        console.log("reproduciendo");
//        console.log(currentPosition);

    }
    function setDefaultOptions(){
        var progress = getProgress();
        var progressBar = getProgressBar();
        var video = getVideo();
        var volume = getVolume();
        progress.value = 0;
        progressBar.value = 0;
        video.muted = false;
        volume.min = 0;
        volume.max = 1;
        volume.step = 0.01;
        volume.value = 0.50;
        video.volume = volume.value;
    }
    function getVolume(){
        return document.getElementById("volume");
    }
    function getProgressBar() {
        return document.getElementById("progressBar");
    }
    function getVideo() {
        return document.getElementById("video");
    }
    function getWebPlayer(){
        return document.getElementById("webPlayer");
    }
    function getProgress(){
        return document.getElementById("progress");
    }
    function setButtons(video){
        setButtonPlay(video);
        setButtonPause(video);
        setButtonStop(video);
        setButtonMute(video);
        setButtonFullScreen();
    }
    function setButtonPlay(video){
        var button1 = document.getElementById("play");
        button1.addEventListener("click", function(){toPlay(video)}, true);
    }
    function setButtonPause(video){
        var button2 = document.getElementById("pause");
        button2.addEventListener("click", function(){toPause(video)}, true);
    }
    function setButtonStop(video){
        var button3 = document.getElementById("stop");
        button3.addEventListener("click", function (){toStop(video)}, true);
    }
    function setButtonMute(video){
        var button4 = document.getElementById("mute");
        button4.addEventListener("click", function(){toMute(video)}, true);
    }
    function setButtonFullScreen(){
        var button5 = document.getElementById("fullScreen");
        button5.addEventListener("click", function () {toggleFullScreen()}, true);
    }
    function showMenu(){
        var menu = document.getElementById("menu");
            menu.style.visibility = "visible";
    }
</script>


<body onload="webPlayer()">
    <div class="container col-xs-12 col-sm-10 col-sm-offset-1 col-md-8 col-md-offset-2 col-lg-6 col-lg-offset-3" id="webPlayer">
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 container display" id="display">
            <video class="col-xs-12 col-sm-12 col-md-12 col-lg-12 container" id="video">
                <source src="./Jamiroquai%20-%20Canned%20Heat.mp4" type="video/mp4"/>
                <!--<source src="pesca.webm" type="video/webm"/>-->
                <!--<source src="MOV_0003.MP4" type="video/mp4"/>-->
                <!--<source src="dummy.mp4" type="video/mp4"/>-->
                Your browser not support this video
            </video>
        </div>
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 container menu" id="menu">
            <div class="container col-xs-12 col-sm-12 col-md-12 col-lg-12 boxProgress" id="boxProgress">
                <input class="col-xs-10 progressbar container" type="range" name="progressBar" id="progressBar"/>
                <progress class="col-xs-12 progress container" id="progress"></progress>
            </div>
            <div  class="col-xs-12 col-sm-12 col-md-12 col-lg-12 container controls" id="controls">
                <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3 container">
                    <span class="glyphicon glyphicon-play pointer" name="play" id="play"></span>
                    <span class="glyphicon glyphicon-pause pointer" name="pause" id="pause"></span>
                    <span class="glyphicon glyphicon-stop pointer" name="stop" id="stop"></span>
                    <span class="glyphicon glyphicon-volume-off pointer" name="mute" id="mute"></span>
                </div>
                <div class="col-xs-3 col-sm-3 col-md-3 col-lg-3 container">
                    <input type="range" class="col-xs-2 element container" name="volume" id="volume"/>
                </div>
                <div class="col-xs-3 col-sm-3 col-md-3 col-lg-3 container">
                    <p class="element timer" id="actualPosition">0:00</p>
                </div>
                <div class="col-xs-2 col-sm-2 col-md-2 col-lg-2 container">
                    <span class="glyphicon glyphicon-fullscreen pointer" name="fullScreen" id="fullScreen"></span>
                </div>
            </div>
        </div>
    </div>
</body>
</html>